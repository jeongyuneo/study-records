# Normalization & DeNormalization

## 1. Normalization

정규화(Normalization) 과정은 릴레이션 간 잘못된 종속 관계로 인해 데이터베이스 이상 현상이 일어나 이를 해결하거나, 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정이다.

쉽게 말해 릴레이션 간 중복을 제거하는 과정이다.

### 1.1. Anomaly

이상 현상(Anomaly)은 정규화를 거치지 않은 데이터베이스에서 발생할 수 있는 현상이다.

- 데이터들이 불필요하게 중복되어 릴레이션 조작에 예기치 못한 문제가 발생할 수 있다.
- 애트리뷰트들의 종속관계를 하나의 릴레이션에 표현하기 때문에 발생한다.

**이상 현상 종류**

1. 삽입 이상(Insertion Anomaly): 데이터 삽입 시 의도와 다른 값들도 삽입
2. 삭제 이상(Delete Anomaly): 데이터 삭제 시 의도와 다른 값들도 연쇄 삭제
3. 갱신 이상(Update Anomaly): 속성값 갱신 시 일부 튜플만 갱신되어 모순 발생

### 1.2 Normalization 장점

- 중복을 배제하여 삽입, 삭제, 갱신 이상의 발생을 방지(이상 현상 제거)
- 각 릴레이션에 중복된 종속성을 여러개의 릴레이션에 분할
- 어떠한 릴레이션이라도 데이터베이스 내에서 표현 가능하게 함
- 데이터 삽입 시 릴레이션을 재구성할 필요성 감소
- 효과적인 검색 알고리즘 생성 가능

### 1.3. Normalization 단점

- 릴레이션의 분해로 인해 릴레이션 간의 `JOIN` 연산이 많아진다.
- 질의에 대한 응답 시간이 느려질 **수도** 있다.

  데이터 중복 속성을 제거하고 결정자에 의해 동일한 의미의 일반 속성이 하나의 테이블로 집약되므로 한 테이블의 데이터 용량이 최소화되는 효과가 있다.

  → 데이터 처리 시 속도가 빨라질 수도 느려질 수도 있다.

  if) `JOIN`이 많이 발생해 성능 저하가 나타나면 **반정규화(De-normalization)** 를 적용할 수 있다.


## 2. Normalization Procedure

### **2.1. 제 1정규화(INF)**

> 도메인이 원자값

릴레이션의 모든 도메인이 더 이상 분해될 수 없는 원자값(Atomic Value)만으로 구성되어야 한다.

릴레이션의 속성 값 중 한 개의 기본키에 대해 두 개 이상의 값을 가지는 반복 집합이 있으면 안된다.

![](https://velog.velcdn.com/images/minide/post/369b3f13-9521-421a-9c20-26b3c0519fa6/image.png)

→ 제 1정규형 만족하지 못하면 갱신 이상, 삭제 이상 발생 가능

### **2.2. 제 2정규화(2NF)**

> 부분적 함수 종속 제거

릴레이션이 제 1정규형이며 부분 함수의 종속성을 제거한 형태다.

부분 함수의 종속성 제거란 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것이다.

![](https://velog.velcdn.com/images/minide/post/c90efc5f-cdcf-4a1b-86c0-d2b905a54fee/image.png)

→ 제 2정규형 만족하지 못하면 삽입 이상, 갱신 이상, 삭제 이상 발생 가능

### **2.3. 제 3정규화(3NF)**

> 이행적 함수 종속 제거

릴레이션이 제 2정규형이고 기본키가 아닌 모든 속성이 이행적 함수 종속(transitive FD)을 만족하지 않아야 한다.

이행적 함수 종속이란 A→B와 B→C가 존재하면 논리적으로 A→C가 성립하는데, 이때 집합 C가 집합 A에 이행적으로 함수 종속이 되었다고 한다.

![](https://velog.velcdn.com/images/minide/post/85882f37-c382-455e-bd08-ec9645ccd6ac/image.png)

→ 제 3정규형 만족하지 못하면 삽입 이상, 갱신 이상, 삭제 이상 발생 가능

### **2.4. 보이스/코드 정규화(BCNF)**

> 결정자이면서 후보키 아닌 것 제거

릴레이션이 제 3정규형이고, 결정자가 후보키가 아닌 함수 종속 관계를 제거해 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태다.

-  **결정자**: 함수 종속 관계에서 특정 종속자(dependent)를 결정짓는 요소 ex) ‘X→Y’일 때 X는 결정자, Y는 종속자

![](https://velog.velcdn.com/images/minide/post/55c7912e-346b-4c88-a376-b4ac50557915/image.png)

→ 보이스/코드 정규형 만족하지 못하면 삽입 이상, 갱신 이상, 삭제 이상 발생 가능


(보통 정규화는 BCNF까지 하는 경우가 많다. 그 이상 정규화를 하면 정규화의 단점이 나타날 수 있다.)

### **2.5. 제 4정규화(4NF)**

> 다치 종속성 제거

릴레이션이 보이코스/코드 정규형이고, 다치 종속(Multi-valued dependency)이 없어야 한다.

다치 종속이란 A→B일 때 하나의 A값에 여러 개의 B값이 존재하면 다치 종속성을 가진다고 하고 A↠B라고 표시한다.

![](https://velog.velcdn.com/images/minide/post/59fc3437-4f5a-4fa8-9042-74c4b50442f8/image.png)

### **2.6. 제 5정규화(5NF)**

> 조인 종속성 제거

릴레이션이 제 4정규형이고, 조인 종속(Join dependency)이 없어야 한다. (조인 연산 시 손실이 없어야 한다.)

제 5정규형은

1. 여러개의 릴레이션으로 한 릴레이션을 분해했을 때, 모든 나눠진 릴레이션이 **원래 릴레이션의 슈퍼키**이며
2. 릴레이션을 **더 분해**할 경우, 기존 릴레이션의 **정보가 손실**되기 때문에 **더 이상 릴레이션이 분해가 될 수 없는 경우**를 말한다.

## 3. DeNormalization

역정규화(DeNormalization)는 정규화를 통해 만들어진 릴레이션을 개발적 측면에서 성능이나 편의성을 위해 되돌리는 작업이다.

### 3.1. JOIN 줄이기

`JOIN`이 빈번하게 발생하는 테이블을 역정규화함으로써 데이터 중복이 발생하지만, `JOIN`을 줄여 훨씬 빠르게 데이터를 가져올 수 있다.

![](https://velog.velcdn.com/images/minide/post/7d6c43d5-db35-42b9-8a56-5a92c9bb2da9/image.png)

### 3.2. 계산 작업 줄이기

테이블에 파생 컬럼을 만들어 `GROUP BY`, `COUNT` 계산 작업을 줄인다.

count 값이 필요한 경우 GROUP BY를 통해 컬럼을 묶고 조회하면 되지만, 이러한 쿼리가 빈번하게 일어나면 부하가 일어난다.

따라서 그룹핑을 해서 내장함수를 쓰는 대신 count 컬럼을 추가해 부하를 줄일 수 있다.

유효한 count 값을 유지하기 위해 데이터가 추가될 때마다 지속적으로 count 값을 수정해야 한다.

![](https://velog.velcdn.com/images/minide/post/603c147a-746a-4508-b30c-aa287aecd2dd/image.png)

### 3.3. 테이블 분리

용량이 매우 큰 컬럼을 다른 테이블로 분리한다.

테이블의 특정 컬럼의 용량이 엄청 클 때, 해당 테이블을 자주 조회하면 부하가 올 수 있다.

그래서 해당 테이블의 읽기 성능 향상을 위해 용량이 큰 테이블을 따로 분리하여 여러 대의 서버에서 각기 다르게 접근해 처리함으로써 성능을 향상시킬 수 있다.

![](https://velog.velcdn.com/images/minide/post/ebe0582f-b4d2-4d11-996a-41771e908d62/image.png)

혹은 테이블의 엄청나게 많은 행이 있을 때 테이블을 분리해서 key 값에 따라 각기 다른 테이블로 접근하게 함으로써 부하를 줄일 수 있다.

![](https://velog.velcdn.com/images/minide/post/7156d350-4611-4177-a23f-295014c4aa60/image.png)

MySQL에서 **파티션 기법**이 이 방법을 이용하는 것이다.

### 3.4. 외래키 줄이기

외래키를 통해 `JOIN`을 줄인다.

`JOIN`문 2회 이상이 필요한 테이블에 대해 외래키 컬럼을 추가함으로써 `JOIN`을 줄일 수 있다.

## References

[데이터베이스 정규화](https://itwiki.kr/w/데이터베이스_정규화)

[[복습]데이터베이스 정규화 -4 (4NF, 5NF)](https://zzozzomin08.tistory.com/12)

[제 1-2-3 정규화 & 역정규화 기법 정리 - Inpa Dev](https://inpa.tistory.com/entry/DB-%F0%9F%93%9A-%EC%A0%9C-1-2-3-%EC%A0%95%EA%B7%9C%ED%99%94-%EC%97%AD%EC%A0%95%EA%B7%9C%ED%99%94)
